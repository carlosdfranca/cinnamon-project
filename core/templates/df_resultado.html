{% extends 'base/base.html' %}
{% load static %}
{% load custom_tags %}

{% block title %}Demonstração Financeira{% endblock %}

{% block conteudo %}
{% include 'base/navbar.html' %}

<div class="container mt-4">
  <div class="card shadow rounded p-4">

    <!-- Cabeçalho -->
    <div class="row mb-4">
      <div class="col-md-9">
        <div class="fw-bold" style="font-size: 1.05rem;">
          {{ fundo.nome|upper }}
        </div>
        <div class="fw-bold">
          CNPJ: {{ fundo.cnpj }}
        </div>
        <div class="mt-2">
          {{ fundo.empresa.nome }}
        </div>
        <div>
          CNPJ: {{ fundo.empresa.cnpj }}
        </div>
      </div>

      <div class="col-md-3 text-end">
        {% if data_anterior == 'ZERADO' %}
          {% with 'ZERADO' as data_anterior_url %}
            <a href="{% url 'exportar_dfs_excel' fundo.id data_atual|date:'Y-m-d' data_anterior_url %}" class="btn btn-success">
              Baixar Demonstração Financeira <i class="bi bi-file-earmark-excel-fill ms-2"></i>
            </a>
          {% endwith %}
        {% else %}
          {% with data_anterior|date:'Y-m-d' as data_anterior_url %}
            <a href="{% url 'exportar_dfs_excel' fundo.id data_atual|date:'Y-m-d' data_anterior_url %}" class="btn btn-success">
              Baixar Demonstração Financeira <i class="bi bi-file-earmark-excel-fill ms-2"></i>
            </a>
          {% endwith %}
        {% endif %}
      </div>
    </div>

    <!-- Período -->
    <div class="mb-3">
      <span class="fw-bold">Período analisado:</span>
      <span class="text-primary">
        {{ data_anterior|date:"d/m/Y" }} → {{ data_atual|date:"d/m/Y" }}
      </span>
    </div>

    <!-- Abas -->
    <ul class="nav nav-tabs d-flex" id="myTabjustified" role="tablist">
      <li class="nav-item flex-fill" role="presentation">
        <button class="nav-link w-100 active" id="dpf-tab" data-bs-toggle="tab" data-bs-target="#dpf-justified"
                type="button" role="tab" aria-controls="dpf" aria-selected="true">DPF</button>
      </li>
      <li class="nav-item flex-fill" role="presentation">
        <button class="nav-link w-100" id="dre-tab" data-bs-toggle="tab" data-bs-target="#dre-justified"
                type="button" role="tab" aria-controls="dre" aria-selected="false">DRE</button>
      </li>
      <li class="nav-item flex-fill" role="presentation">
        <button class="nav-link w-100" id="dmpl-tab" data-bs-toggle="tab" data-bs-target="#dmpl-justified"
                type="button" role="tab" aria-controls="dmpl" aria-selected="false">DMPL</button>
      </li>
      <li class="nav-item flex-fill" role="presentation">
        <button class="nav-link w-100" id="dfc-tab" data-bs-toggle="tab" data-bs-target="#dfc-justified"
                type="button" role="tab" aria-controls="dfc" aria-selected="false">DFC</button>
      </li>
    </ul>

    <!-- Conteúdo das abas -->
    <div class="tab-content pt-2" id="myTabjustifiedContent">

      <!-- DPF -->
      <div class="tab-pane fade show active" id="dpf-justified" role="tabpanel" aria-labelledby="dpf-tab">
        <div class="fw-bold mt-3">Demonstração da Posição Financeira</div>
        <div class="fw-bold">
          Em {{ data_atual|date:"d/m/Y" }} e {{ data_anterior|date:"d/m/Y" }}
        </div>
        <div class="fst-italic" style="font-size: 0.85rem;">
          (Valores expressos em milhares de reais, exceto quando indicado de outra forma)
        </div>

        {% include 'partials/dpf_table.html' %}
      </div>

      <!-- DRE -->
      <div class="tab-pane fade" id="dre-justified" role="tabpanel" aria-labelledby="dre-tab">
        <div class="fw-bold mt-3">Demonstração do Resultado do Exercício</div>
        <div class="fw-bold">
          Períodos findos em {{ data_atual|date:"d/m/Y" }} e {{ data_anterior|date:"d/m/Y" }}
        </div>
        <div class="fst-italic" style="font-size: 0.85rem;">
          (Valores expressos em milhares de reais)
        </div>

        {% include 'partials/dre_table.html' %}
      </div>

      <!-- DMPL -->
      <div class="tab-pane fade" id="dmpl-justified" role="tabpanel" aria-labelledby="dmpl-tab">
        <div class="fw-bold mt-3">Demonstração das Mutações do Patrimônio Líquido</div>
        <div class="fw-bold">
          Períodos findos em {{ data_atual|date:"d/m/Y" }} e {{ data_anterior|date:"d/m/Y" }}
        </div>
        <div class="fst-italic" style="font-size: 0.85rem;">
          (Valores expressos em milhares de reais, exceto valor unitário das cotas)
        </div>

        {% include 'partials/dmpl_table.html' %}
      </div>

      <!-- DFC -->
      <div class="tab-pane fade" id="dfc-justified" role="tabpanel" aria-labelledby="dfc-tab">
        <div class="fw-bold mt-3">Demonstração dos Fluxos de Caixa – Método Indireto</div>
        <div class="fw-bold">
          Períodos findos em {{ data_atual|date:"d/m/Y" }} e {{ data_anterior|date:"d/m/Y" }}
        </div>
        <div class="fst-italic" style="font-size: 0.85rem;">
          (Valores expressos em milhares de reais)
        </div>

        {% include 'partials/dfc_table.html' %}
      </div>

    </div> <!-- tab-content -->
  </div> <!-- card -->
</div> <!-- container -->
{% endblock %}
